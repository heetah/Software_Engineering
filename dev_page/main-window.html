<!DOCTYPE html>
<html lang="zh-TW">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <meta http-equiv="Content-Security-Policy"
    content="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'; font-src 'self' data:;">

  <title>Multi-Agent AI Copilot</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="icons.css">
  <link rel="stylesheet" href="agent-logs.css">
</head>

<body>

  <div class="app-layout">

    <div class="sidebar">
      <div class="sidebar-header" id="sidebar-header">
        <button class="sidebar-header-btn" id="tutorial-btn" title="重看新手教學">
          <span class="icon icon--muted"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"
              stroke-linecap="round" stroke-linejoin="round">
              <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z" />
              <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" />
            </svg></span>
        </button>
        <button class="sidebar-header-btn" id="refresh-session-btn" title="開始新對話">
          <span class="icon icon--muted"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"
              stroke-linecap="round" stroke-linejoin="round">
              <line x1="12" y1="5" x2="12" y2="19" />
              <line x1="5" y1="12" x2="19" y2="12" />
            </svg></span>
        </button>
      </div>

      <div class="sidebar__menu">
        <button class="menu-button is-active" id="chat-button">
          <span class="icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"
              stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
            </svg></span> 聊天
        </button>

        <button class="menu-button" id="history-button">
          <span class="icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"
              stroke-linecap="round" stroke-linejoin="round">
              <line x1="3" y1="6" x2="21" y2="6" />
              <line x1="3" y1="12" x2="21" y2="12" />
              <line x1="3" y1="18" x2="21" y2="18" />
            </svg></span> 歷史紀錄
          <span class="dropdown-arrow">▼</span>
        </button>

        <div class="history-list" id="history-list">
        </div>

        <button class="menu-button" id="library-button">
          <span class="icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"
              stroke-linecap="round" stroke-linejoin="round">
              <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z" />
            </svg></span> 專案庫
        </button>

        <button class="menu-button" id="settings-button">
          <span class="icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"
              stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="3" />
              <path d="M12 1v6m0 6v6M5.6 5.6l4.2 4.2m4.2 4.2l4.2 4.2M1 12h6m6 0h6M5.6 18.4l4.2-4.2m4.2-4.2l4.2-4.2" />
            </svg></span> 設定
        </button>
      </div>
    </div>

    <div class="content-area">

      <div class="page is-active" id="page-chat">

        <div class="chat-display" id="chat-display">
        </div>

        <div id="input-area-container">
          <div class="input-area">
            <textarea class="input-field" id="text-input" placeholder="在這裡輸入訊息..." rows="1"></textarea>

            <input type="file" id="file-upload-input" style="display: none;">

            <div class="input-actions">
              <span class="char-counter" id="char-counter">0</span>
              <button class="action-button action-button--icon" id="file-upload-button" title="上傳檔案">
                📎
              </button>
              <button class="action-button action-button--send" id="send-button" title="發送">
                ➤
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="page" id="page-settings">
        <div class="page-content-wrapper">
          <h1 class="page-title">設定</h1>

          <div class="settings-grid">

            <div class="settings-card">
              <h3 class="settings-card__title">顯示</h3>
              <p class="settings-card__description">
                調整應用程式的外觀主題。
              </p>
              <div class="settings-action-group">
                <label class="settings-label" for="theme-toggle-input">深色模式</label>
                <p class="settings-label-description">
                  切換使用黑色背景並以暖色調為輔的深色主題。
                </p>
                <label class="toggle-switch" for="theme-toggle-input">
                  <input type="checkbox" id="theme-toggle-input" class="toggle-switch__input">
                  <span class="toggle-switch__slider"></span>
                </label>
              </div>
            </div>

            <div class="settings-card">
              <h3 class="settings-card__title">API Key 設定</h3>
              <p class="settings-card__description">
                管理與 LLM 服務連線所需的金鑰。
              </p>

              <div class="settings-action-group">
                <p class="settings-label-description">
                  這些金鑰僅在本機儲存並用於呼叫對應的 LLM 服務，不會上傳到伺服器。
                </p>

                <div class="settings-input-group">
                  <label class="settings-input-label" for="gemini-api-key-input">Gemini API Key</label>
                  <input type="password" id="gemini-api-key-input" class="input-field settings-input-field"
                    placeholder="輸入 Gemini API Key" autocomplete="off">
                </div>

                <div class="settings-input-group">
                  <label class="settings-input-label" for="openai-api-key-input">OpenAI API Key</label>
                  <input type="password" id="openai-api-key-input" class="input-field settings-input-field"
                    placeholder="輸入 OpenAI API Key" autocomplete="off">
                </div>

                <button class="action-button action-button--save" id="save-api-keys-button">
                  儲存
                </button>
              </div>
            </div>

            <div class="settings-card">
              <h3 class="settings-card__title">資料管理</h3>
              <p class="settings-card__description">
                管理您的對話紀錄與應用程式資料。
              </p>

              <div class="settings-action-group">
                <label class="settings-label">資料儲存位置</label>
                <p class="settings-label-description">
                  您的對話資料庫 (chat-history.db) 儲存於此。您可以手動備份此資料夾。
                </p>
                <div class="input-area is-readonly">
                  <input type="text" class="input-field" id="data-path-display" readonly placeholder="正在載入路徑...">
                </div>
              </div>

              <div class="settings-action-group">
                <label class="settings-label">清除所有對話紀錄</label>
                <p class="settings-label-description">
                  這將永久刪除所有會話與訊息。此操作無法復原。
                </p>
                <button class="action-button action-button--danger" id="clear-history-button">
                  清除所有紀錄
                </button>
              </div>
            </div>

            <div class="settings-card">
              <h3 class="settings-card__title">LLM 選擇</h3>
              <p class="settings-card__description">
                選擇用於生成專案程式碼的後端 LLM 服務（僅影響 Coder Agent）。
              </p>

              <div class="settings-action-group">
                <label class="settings-label">模型提供者</label>
                <p class="settings-label-description">
                  選擇要優先使用的模型服務。如果環境中沒有對應的 API Key，請求可能會失敗。
                </p>
                <div class="settings-toggle-group" id="llm-provider-group">
                  <label class="settings-toggle-option">
                    <input type="radio" name="llm-provider" value="auto" id="llm-provider-auto"
                      class="toggle-switch__input">
                    <span class="toggle-label">自動（優先 Gemini，其次 OpenAI）</span>
                    <span class="toggle-switch">
                      <span class="toggle-switch__slider"></span>
                    </span>
                  </label>
                  <label class="settings-toggle-option">
                    <input type="radio" name="llm-provider" value="gemini" id="llm-provider-gemini"
                      class="toggle-switch__input">
                    <span class="toggle-label">只使用 Gemini</span>
                    <span class="toggle-switch">
                      <span class="toggle-switch__slider"></span>
                    </span>
                  </label>
                  <label class="settings-toggle-option">
                    <input type="radio" name="llm-provider" value="openai" id="llm-provider-openai"
                      class="toggle-switch__input">
                    <span class="toggle-label">只使用 OpenAI</span>
                    <span class="toggle-switch">
                      <span class="toggle-switch__slider"></span>
                    </span>
                  </label>
                </div>
              </div>

              <div class="settings-action-group">
                <label class="settings-label">圈選搜尋模式</label>
                <p class="settings-label-description">
                  設定使用「圈選搜尋」功能時的預設行為。
                </p>
                <div class="settings-toggle-group" id="search-mode-group">
                  <label class="settings-toggle-option">
                    <input type="radio" name="search-mode" value="ask" id="search-mode-ask"
                      class="toggle-switch__input">
                    <span class="toggle-label">每次詢問</span>
                    <span class="toggle-switch">
                      <span class="toggle-switch__slider"></span>
                    </span>
                  </label>
                  <label class="settings-toggle-option">
                    <input type="radio" name="search-mode" value="lens" id="search-mode-lens"
                      class="toggle-switch__input">
                    <span class="toggle-label">Google 智慧鏡頭</span>
                    <span class="toggle-switch">
                      <span class="toggle-switch__slider"></span>
                    </span>
                  </label>
                  <label class="settings-toggle-option">
                    <input type="radio" name="search-mode" value="ai" id="search-mode-ai" class="toggle-switch__input">
                    <span class="toggle-label">AI 智能分析</span>
                    <span class="toggle-switch">
                      <span class="toggle-switch__slider"></span>
                    </span>
                  </label>
                </div>
              </div>
            </div>

            <div class="settings-card" id="about-app-card">
              <h3 class="settings-card__title">關於 & 說明</h3>
              <p class="settings-card__description">
                版本資訊、快捷鍵與常見問題。
              </p>

              <div class="settings-action-group">
                <label class="settings-label">工程師快捷鍵</label>
                <p class="settings-label-description">
                  <b>F12</b>：開啟開發者工具 (Debug)<br>
                  <b>Ctrl + R</b> (Cmd + R)：重新載入/新對話<br>
                  <b>Cmd/Ctrl + Shift + A</b>：圈選搜尋
                </p>
              </div>

              <div class="settings-action-group">
                <label class="settings-label">常見問題 (FAQ)</label>
                <p class="settings-label-description">
                  <b>Q: 下載專案失敗？</b><br>
                  請確認您有權限寫入目標資料夾，且路徑中沒有特殊字元。
                </p>
                <p class="settings-label-description">
                  <b>Q: 對話紀錄存在哪裡？</b><br>
                  本機資料庫：<code>.ai-copilot-assistant/chat-history.db</code>
                </p>
              </div>

              <div class="settings-action-group">
                <label class="settings-label">隱私聲明</label>
                <p class="settings-label-description">
                  本應用程式採「離線優先」設計。您的 API Key 與對話紀錄皆加密儲存於本機，不會上傳至第三方伺服器。
                </p>
              </div>

              <div class="settings-action-group">
                <p class="settings-label-description" style="opacity: 0.3; margin-top: 10px;">
                  Multi-Agent AI Copilot v1.1.0
                </p>
              </div>
            </div>

          </div>
        </div>
      </div>

      <div class="page" id="page-library">
        <div class="page-content-wrapper">
          <h1 class="page-title">專案庫</h1>

          <div class="library-controls">
            <div class="library-stats">
              <span id="project-count">載入中...</span>
            </div>
            
            <div class="search-container">
              <input type="text" id="project-search-input" class="library-search-input" placeholder="搜尋專案...">
            </div>

            <button class="library-sort-btn" id="sort-projects-btn" title="切換排序">
              <span id="sort-icon">🕒</span>
              <span id="sort-label">最新 → 最舊</span>
            </button>
          </div>

          <div class="library-container" id="library-container">
          </div>
        </div>
      </div>

      <div class="tutorial-overlay" id="tutorial-overlay">
        <div class="tutorial-spotlight" id="tutorial-spotlight"></div>
        <div class="tutorial-bubble" id="tutorial-bubble">
          <div class="tutorial-text" id="tutorial-text"></div>
          <div class="tutorial-actions">
            <button class="action-button" id="tutorial-next-btn">下一步</button>
          </div>
        </div>
      </div>

      <script src="main-window.js"></script>
</body>

</html>