{
  "comment": "Example 9: Real-time Chat Application - 測試端口配置 (5001) 和 WebSocket 整合",
  "output": {
    "coder_instructions": {
      "task": "Create a real-time chat application with Flask-SocketIO backend and responsive frontend",
      "requirements": "User can enter nickname and join chat room, send messages in real-time using WebSocket, display message history with timestamps, show online users list, typing indicator when someone is typing, message notifications, emoji support, responsive design for mobile, auto-scroll to latest message, username color coding",
      
      "files": [
        {
          "path": "index.html",
          "type": "html",
          "description": "Chat application layout: login screen with nickname input (id: nickname-input) and join button (id: join-btn), main chat interface (hidden initially, id: chat-container) with header showing room name and online count (id: online-count), sidebar with online users list (id: users-list), main chat area with messages container (id: messages) displaying messages with username, timestamp, and text, typing indicator (id: typing-indicator), message input section with textarea (id: message-input), send button (id: send-btn), and emoji picker button (id: emoji-btn). Include Socket.IO client script from CDN"
        },
        {
          "path": "style.css",
          "type": "css",
          "description": "Modern chat UI styling: flexbox layout with sidebar (250px width) and main chat area, gradient background for header (#667eea to #764ba2), message bubbles with different colors for own messages (align right, blue) and others (align left, gray), smooth animations for new messages (slideIn from bottom 0.3s), typing indicator with animated dots, online users with green status dot, message input with rounded corners and shadow, send button with hover effect, emoji picker dropdown, responsive design: stack sidebar below chat on mobile (<768px), smooth scrollbar styling for messages container"
        },
        {
          "path": "app.js",
          "type": "javascript",
          "description": "Frontend WebSocket logic: on load connect to Socket.IO server at window.location.origin, handle join button: emit 'join' event with nickname, show chat container, hide login screen. Listen for 'user_joined' event: add user to online list, show notification. Listen for 'user_left' event: remove user from list. Listen for 'message' event: append message to messages container with username, timestamp, and text, auto-scroll to bottom. Handle send button: emit 'send_message' event with message text and clear input. Handle typing: emit 'typing' event when user types, show typing indicator for other users. Handle emoji picker: toggle emoji selection, insert emoji into message input. Store current username in variable, use different styling for own messages vs others"
        },
        {
          "path": "server.py",
          "type": "python",
          "description": "Flask-SocketIO backend: use Flask, Flask-SocketIO, Flask-CORS. Initialize app with Flask(__name__, static_folder='.', static_url_path=''), enable CORS, create SocketIO instance. Maintain connected users dictionary {sid: {username, color}}. Route GET / serves index.html. SocketIO event 'join': receive {username}, generate random color for user, store in users dict, broadcast 'user_joined' with {username, users_list, count} to all clients. Event 'disconnect': remove user from dict, broadcast 'user_left' with {username, users_list, count}. Event 'send_message': receive {username, text, timestamp}, broadcast 'message' with {username, text, timestamp, color} to all. Event 'typing': receive {username}, broadcast 'typing' with {username} to all except sender. Include error handling, use emit for responses, use broadcast=True for room messages"
        },
        {
          "path": "config.py",
          "type": "python",
          "description": "Configuration: PORT from environment (default 5001), SECRET_KEY for Flask sessions, CORS_ORIGINS list (allow localhost:5001), SOCKETIO_CORS_ALLOWED_ORIGINS same as CORS_ORIGINS, MAX_MESSAGE_LENGTH 500 characters, ROOM_NAME default 'General', DEBUG mode setting"
        }
      ],
      
      "contracts": {
        "api": [
          {
            "endpoint": "GET /",
            "method": "GET",
            "description": "Serve main chat interface",
            "producers": ["server.py"],
            "consumers": ["browser"]
          }
        ],
        "socketio": [
          {
            "event": "join",
            "direction": "client->server",
            "description": "User joins chat room",
            "payload": {
              "username": "string"
            },
            "producers": ["app.js"],
            "consumers": ["server.py"]
          },
          {
            "event": "user_joined",
            "direction": "server->client",
            "description": "Notify all users when someone joins",
            "payload": {
              "username": "string",
              "users_list": "array",
              "count": "number"
            },
            "producers": ["server.py"],
            "consumers": ["app.js"]
          },
          {
            "event": "send_message",
            "direction": "client->server",
            "description": "Send chat message",
            "payload": {
              "username": "string",
              "text": "string",
              "timestamp": "string"
            },
            "producers": ["app.js"],
            "consumers": ["server.py"]
          },
          {
            "event": "message",
            "direction": "server->client",
            "description": "Broadcast message to all users",
            "payload": {
              "username": "string",
              "text": "string",
              "timestamp": "string",
              "color": "string"
            },
            "producers": ["server.py"],
            "consumers": ["app.js"]
          },
          {
            "event": "typing",
            "direction": "client->server",
            "description": "User is typing indicator",
            "payload": {
              "username": "string"
            },
            "producers": ["app.js"],
            "consumers": ["server.py"]
          },
          {
            "event": "user_left",
            "direction": "server->client",
            "description": "Notify when user disconnects",
            "payload": {
              "username": "string",
              "users_list": "array",
              "count": "number"
            },
            "producers": ["server.py"],
            "consumers": ["app.js"]
          }
        ],
        "dom": [
          {
            "id": "nickname-input",
            "type": "input",
            "purpose": "User enters nickname before joining",
            "accessedBy": ["app.js"]
          },
          {
            "id": "join-btn",
            "type": "button",
            "purpose": "Join chat room button",
            "accessedBy": ["app.js"]
          },
          {
            "id": "chat-container",
            "type": "div",
            "purpose": "Main chat interface container",
            "accessedBy": ["app.js"]
          },
          {
            "id": "messages",
            "type": "div",
            "purpose": "Container for all chat messages",
            "accessedBy": ["app.js"]
          },
          {
            "id": "message-input",
            "type": "textarea",
            "purpose": "User types message here",
            "accessedBy": ["app.js"]
          },
          {
            "id": "send-btn",
            "type": "button",
            "purpose": "Send message button",
            "accessedBy": ["app.js"]
          },
          {
            "id": "users-list",
            "type": "ul",
            "purpose": "Display online users",
            "accessedBy": ["app.js"]
          },
          {
            "id": "online-count",
            "type": "span",
            "purpose": "Show number of online users",
            "accessedBy": ["app.js"]
          },
          {
            "id": "typing-indicator",
            "type": "div",
            "purpose": "Show when someone is typing",
            "accessedBy": ["app.js"]
          }
        ]
      },
      
      "projectConfig": {
        "backend": {
          "host": "localhost",
          "port": 5001,
          "protocol": "http"
        },
        "frontend": {
          "socketUrl": "http://localhost:5001"
        },
        "dependencies": {
          "frontend": {
            "Socket.IO Client": "^4.5.0 (CDN)",
            "Emoji Picker": "optional"
          },
          "backend": {
            "Flask": "3.0.0",
            "Flask-SocketIO": "5.3.0",
            "Flask-CORS": "4.0.0",
            "python-socketio": "5.9.0",
            "python-dotenv": "1.0.0"
          }
        },
        "features": {
          "realtime": "WebSocket communication using Socket.IO",
          "userManagement": "Track connected users with session IDs",
          "colorCoding": "Assign random color to each user for visual distinction",
          "typing": "Show typing indicator with 2-second timeout",
          "notifications": "Toast notifications for user join/leave events"
        }
      }
    }
  }
}
