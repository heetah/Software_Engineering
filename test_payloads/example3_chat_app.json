{
  "comment": "Example 3: Real-time Chat App - HAS contracts.api + contracts.events + contracts.storage + contracts.modules",
  "output": {
    "coder_instructions": {
      "task": "Build a real-time chat application with WebSocket support",
      "requirements": "User authentication, message history, real-time updates, emoji support",
      
      "files": [
        {
          "path": "index.html",
          "type": "html",
          "description": "Chat interface with login form, message list, and input area",
          "dependencies": ["styles.css", "auth.js", "chat.js"]
        },
        {
          "path": "styles.css",
          "type": "css",
          "description": "Modern chat UI with message bubbles and animations",
          "dependencies": []
        },
        {
          "path": "auth.js",
          "type": "javascript",
          "description": "Authentication module with login/logout and session management",
          "dependencies": []
        },
        {
          "path": "chat.js",
          "type": "javascript",
          "description": "WebSocket client for real-time messaging",
          "dependencies": []
        },
        {
          "path": "server.py",
          "type": "python",
          "description": "Flask server with WebSocket support and authentication middleware",
          "dependencies": []
        }
      ],
      
      "contracts": {
        "api": [
          {
            "endpoint": "POST /api/auth/login",
            "description": "User authentication with username/password",
            "request": {
              "username": "string (required, 3-20 chars)",
              "password": "string (required, min 6 chars)"
            },
            "response": {
              "token": "string (JWT token)",
              "userId": "string (UUID)",
              "username": "string"
            },
            "producers": ["server.py"],
            "consumers": ["auth.js"]
          },
          {
            "endpoint": "POST /api/auth/logout",
            "description": "Invalidate user session",
            "request": {
              "token": "string (required, in Authorization header)"
            },
            "response": {
              "success": "boolean",
              "message": "string"
            },
            "producers": ["server.py"],
            "consumers": ["auth.js"]
          },
          {
            "endpoint": "WS /ws/chat",
            "description": "WebSocket connection for real-time chat",
            "request": {
              "type": "message | typing | ping",
              "content": "string (required for type=message)",
              "userId": "string (from token)",
              "timestamp": "string (ISO 8601)"
            },
            "response": {
              "type": "message | userJoined | userLeft | typing | error",
              "content": "string",
              "userId": "string",
              "username": "string",
              "timestamp": "string (ISO 8601)"
            },
            "producers": ["server.py"],
            "consumers": ["chat.js"]
          }
        ],
        "modules": [
          {
            "name": "AuthModule",
            "file": "auth.js",
            "description": "Authentication and session management utilities",
            "exports": {
              "login": {
                "parameters": {
                  "username": "string",
                  "password": "string"
                },
                "returns": "Promise<{token: string, userId: string, username: string}>"
              },
              "logout": {
                "parameters": {},
                "returns": "Promise<void>"
              },
              "getToken": {
                "parameters": {},
                "returns": "string | null"
              },
              "isAuthenticated": {
                "parameters": {},
                "returns": "boolean"
              }
            },
            "importers": ["chat.js"]
          }
        ],
        "events": [
          {
            "name": "auth-changed",
            "description": "Dispatched when user authentication state changes (login/logout)",
            "file": "auth.js",
            "payload": {
              "isAuthenticated": "boolean",
              "userId": "string | null",
              "username": "string | null"
            },
            "emitters": ["auth.js (login, logout)"],
            "listeners": ["chat.js (handleAuthChange)", "index.html (updateUI)"]
          },
          {
            "name": "message-received",
            "description": "Dispatched when new chat message arrives via WebSocket",
            "file": "chat.js",
            "payload": {
              "messageId": "string",
              "content": "string",
              "userId": "string",
              "username": "string",
              "timestamp": "string (ISO 8601)"
            },
            "emitters": ["chat.js (onWebSocketMessage)"],
            "listeners": ["chat.js (renderMessage)"]
          },
          {
            "name": "user-typing",
            "description": "Dispatched when remote user is typing",
            "file": "chat.js",
            "payload": {
              "userId": "string",
              "username": "string",
              "isTyping": "boolean"
            },
            "emitters": ["chat.js (onWebSocketMessage)"],
            "listeners": ["chat.js (showTypingIndicator)"]
          }
        ],
        "storage": [
          {
            "key": "authToken",
            "type": "localStorage",
            "description": "JWT authentication token for persistent login",
            "schema": "string (JWT token)",
            "writers": ["auth.js (login)"],
            "readers": ["auth.js (getToken)", "chat.js (connectWebSocket)"]
          },
          {
            "key": "messageHistory",
            "type": "localStorage",
            "description": "Cached recent messages for offline viewing",
            "schema": {
              "type": "array",
              "items": {
                "messageId": "string",
                "content": "string",
                "userId": "string",
                "username": "string",
                "timestamp": "string"
              },
              "maxLength": 100
            },
            "writers": ["chat.js (saveMessage)"],
            "readers": ["chat.js (loadHistory)"]
          },
          {
            "key": "userPreferences",
            "type": "localStorage",
            "description": "User UI preferences (theme, notification settings)",
            "schema": {
              "theme": "string (enum: 'light' | 'dark')",
              "soundEnabled": "boolean",
              "notificationsEnabled": "boolean"
            },
            "writers": ["index.html (savePreferences)"],
            "readers": ["index.html (loadPreferences)"]
          }
        ],
        "dom": [
          {
            "templateId": "message-template",
            "containerId": "messages-container",
            "description": "Chat message template for rendering messages",
            "requiredElements": [
              {
                "selector": ".message-bubble",
                "element": "div",
                "purpose": "Container for message content with styling",
                "consumers": ["chat.js (renderMessage)"]
              },
              {
                "selector": ".message-content",
                "element": "p",
                "purpose": "Display message text content",
                "consumers": ["chat.js (renderMessage)"]
              },
              {
                "selector": ".message-author",
                "element": "span",
                "purpose": "Display message author username",
                "consumers": ["chat.js (renderMessage)"]
              },
              {
                "selector": ".message-timestamp",
                "element": "time",
                "purpose": "Display message timestamp",
                "consumers": ["chat.js (renderMessage)"]
              }
            ],
            "producers": ["index.html"],
            "consumers": ["chat.js"]
          },
          {
            "description": "Login form structure",
            "requiredElements": [
              {
                "selector": "#login-form",
                "element": "form",
                "purpose": "Login form for authentication",
                "consumers": ["auth.js (handleLogin)"]
              },
              {
                "selector": "#username",
                "element": "input",
                "attributes": { "type": "text", "name": "username", "required": true },
                "purpose": "Username input field",
                "consumers": ["auth.js (handleLogin)"]
              },
              {
                "selector": "#password",
                "element": "input",
                "attributes": { "type": "password", "name": "password", "required": true },
                "purpose": "Password input field",
                "consumers": ["auth.js (handleLogin)"]
              },
              {
                "selector": "#login-error",
                "element": "div",
                "purpose": "Display login error messages",
                "consumers": ["auth.js (showError)"]
              }
            ],
            "producers": ["index.html"],
            "consumers": ["auth.js"]
          },
          {
            "containerId": "chat-container",
            "description": "Chat interface structure",
            "requiredElements": [
              {
                "selector": "#messages-container",
                "element": "div",
                "purpose": "Scrollable container for chat messages",
                "consumers": ["chat.js (renderMessage, scrollToBottom)"]
              },
              {
                "selector": "#message-input",
                "element": "input",
                "attributes": { "type": "text", "placeholder": "Type a message..." },
                "purpose": "Input field for composing messages",
                "consumers": ["chat.js (handleSendMessage, handleTyping)"]
              },
              {
                "selector": "#send-button",
                "element": "button",
                "purpose": "Button to send message",
                "consumers": ["chat.js (handleSendMessage)"]
              },
              {
                "selector": "#typing-indicator",
                "element": "div",
                "purpose": "Show 'User is typing...' indicator",
                "consumers": ["chat.js (showTypingIndicator)"]
              },
              {
                "selector": "#logout-button",
                "element": "button",
                "purpose": "Button to logout",
                "consumers": ["auth.js (handleLogout)"]
              },
              {
                "selector": "#connection-status",
                "element": "div",
                "purpose": "Display WebSocket connection status",
                "consumers": ["chat.js (updateConnectionStatus)"]
              }
            ],
            "producers": ["index.html"],
            "consumers": ["chat.js", "auth.js"]
          }
        ]
      },

      "setup": {
        "runtime": "mixed",
        "pythonVersion": "3.8+",
        "dependencies": {
          "python": [
            "flask==3.0.0",
            "flask-socketio==5.3.0",
            "flask-cors==4.0.0",
            "python-socketio==5.9.0",
            "pyjwt==2.8.0"
          ]
        },
        "environmentVariables": {
          "FLASK_APP": "server.py",
          "FLASK_ENV": "development",
          "PORT": "5000",
          "JWT_SECRET_KEY": "change-this-secret-key-in-production",
          "CORS_ORIGINS": "http://localhost:3000,http://127.0.0.1:3000"
        },
        "startCommands": {
          "backend": "python server.py",
          "frontend": "Open index.html in your browser (or use: python -m http.server 8000)"
        },
        "instructions": "1. Install Python dependencies: `pip install -r requirements.txt`\n2. Copy `.env.example` to `.env` and configure JWT secret\n3. Start backend server: `python server.py`\n4. Open frontend:\n   - Option A: Open `index.html` directly in browser\n   - Option B (recommended): `python -m http.server 8000` then visit http://localhost:8000\n5. Server runs on http://localhost:5000, WebSocket at ws://localhost:5000/ws/chat"
      }
    }
  }
}
